# 2주차 프로젝트 보고서

## 프로젝트 개요
**프로젝트명**: JavaScript 온라인 컴파일러 (JS Online Compiler)  
**작성자**: [작성자명]  
**기간**: 2주차  
**GitHub**: https://github.com/enderpawar/2025_web_programming

---

## 📌 주요 진행 사항

### 1. 핵심 기능 구현 완료

#### 1.1 React 기반 온라인 코드 실행 환경 구축
- **코드 에디터 컴포넌트** (`Editor.jsx`)
  - `textarea` 기반의 코드 입력 UI 구현
  - Run 버튼을 통한 코드 실행 기능
  - 실행 중 상태 표시 (로딩 애니메이션)
  - 코드 실시간 동기화 기능

- **콘솔 출력 시스템** (`Console.jsx`)
  - 5가지 출력 타입 지원:
    - `LOG`: 일반 로그 (회색 다이아몬드 아이콘)
    - `ERROR`: 에러 메시지 (빨간색 X 아이콘)
    - `WARN`: 경고 메시지 (노란색 경고 아이콘)
    - `INFO`: 정보 메시지 (파란색 정보 아이콘)
    - `SUCCESS`: 성공 메시지 (초록색 체크 아이콘)
  - 각 타입별 색상 및 아이콘 차별화
  - Clear 버튼을 통한 콘솔 초기화 기능

#### 1.2 코드 실행 엔진 (`RoomCompiler.jsx`)
```javascript
// Function Constructor를 활용한 동적 코드 실행
const handleRunCode = useCallback(() => {
  const newOutput = [];
  const originalConsole = { ...console };
  
  // Console API 오버라이딩
  const customConsole = {
    log: (...args) => { /* 출력 캡처 */ },
    error: (...args) => { /* 에러 캡처 */ },
    warn: (...args) => { /* 경고 캡처 */ },
    info: (...args) => { /* 정보 캡처 */ }
  };
  
  try {
    // 코드 실행
    const result = new Function(code)();
    if (result !== undefined) {
      newOutput.push({ 
        type: OutputType.LOG, 
        message: `Return value: ${JSON.stringify(result, null, 2)}` 
      });
    }
  } catch (error) {
    newOutput.push({ type: OutputType.ERROR, message: error.message });
  } finally {
    window.console = originalConsole;
    setOutput(newOutput);
  }
}, [code]);
```

**핵심 기술:**
- Function Constructor를 통한 동적 코드 실행
- Console API 오버라이딩을 통한 출력 캡처
- try-catch를 통한 에러 핸들링
- JSON.stringify를 활용한 객체 출력

---

### 2. 데이터 영속성 구현 (로컬 스토리지 활용)

#### 2.1 저장소 유틸리티 (`storage.js`)
```javascript
// 안전한 데이터 읽기 함수 (손상된 데이터 대응)
function read(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  } catch {
    return fallback;  // 파싱 실패 시 기본값 반환
  }
}

// 데이터 쓰기 함수
function write(key, value) {
  localStorage.setItem(key, JSON.stringify(value));
}
```

#### 2.2 구현된 저장 기능
1. **Room 관리**
   - Room 목록 저장 및 불러오기
   - Room 생성 및 삭제
   - Room별 코드 저장 (`jsc.room.${id}.code`)

2. **코드 저장 시스템**
   - 사용자별 코드 자동 저장
   - 타임스탬프를 통한 저장 시점 기록
   - Room별, 문제별 코드 개별 저장

3. **초기 데이터 시딩**
   - 샘플 Room 자동 생성 기능
   - 군산대, 고려대, 아주대 샘플 데이터 제공

---

### 3. 서버 사이드 기능 확장

#### 3.1 Express 기반 REST API (`server/index.js`)
- **인증 시스템**
  - JWT 기반 사용자 인증
  - bcrypt를 통한 비밀번호 해싱
  - 회원가입/로그인 API

- **Room 관리 API**
  - Room CRUD (생성, 조회, 수정, 삭제)
  - Room별 권한 관리 (소유자/공개/비공개)
  - Room 공유 기능

- **코드 저장 API**
  - 사용자별 코드 저장/불러오기
  - 문제별 코드 관리
  - 실시간 코드 동기화 (Socket.IO)

#### 3.2 코드 실행 샌드박스
```javascript
// Node.js vm 모듈을 활용한 안전한 코드 실행
function runCodeTest(code, functionName, testCase, useDOM = false) {
  const context = vm.createContext({ 
    console: { log(){}, error(){}, warn(){}, info(){} } 
  });
  
  const script = new vm.Script(scriptCode, { timeout: 1000 });
  const fn = script.runInContext(context, { timeout: 1000 });
  
  const result = fn.apply(null, input);
  // 결과 검증 및 반환
}
```

#### 3.3 실시간 협업 (Socket.IO)
- Room별 코드 동기화
- 여러 사용자 간 실시간 코드 공유
- 클라이언트별 변경 사항 브로드캐스팅

---

## 🎯 구현된 주요 기능 요약

### 1. 코드 에디터
- [x] textarea 기반 코드 입력 UI
- [x] Run/Save 버튼 기능
- [x] 실행 중 상태 표시
- [x] 코드 하이라이팅 준비 (Monaco Editor 도입 예정)

### 2. 콘솔 시스템
- [x] 5가지 출력 타입 구분 (LOG, ERROR, WARN, INFO, SUCCESS)
- [x] 타입별 아이콘 및 색상 적용
- [x] Console API 오버라이딩
- [x] Clear 기능

### 3. 코드 실행 엔진
- [x] Function Constructor 기반 동적 실행
- [x] 에러 핸들링 및 캡처
- [x] JSON 직렬화 안전 처리
- [x] 순환 참조 객체 대응

### 4. 데이터 저장
- [x] Room별 코드 저장
- [x] 로컬 스토리지 활용
- [x] 손상된 데이터 복구 메커니즘
- [x] 자동 저장 기능

### 5. 서버 기능
- [x] JWT 인증 시스템
- [x] REST API (Room, Code CRUD)
- [x] Socket.IO 실시간 동기화
- [x] vm 모듈 기반 샌드박스 실행

---

## 🚧 어려웠던 점 및 해결 방법

### 1. Console API 오버라이딩
**문제**: 사용자 코드의 `console.log` 출력을 브라우저 콘솔이 아닌 커스텀 콘솔에 캡처해야 함

**해결**:
```javascript
// 원본 console 백업
const originalConsole = { ...console };

// 커스텀 console 구현
window.console.log = customConsole.log;
window.console.error = customConsole.error;
// ...

try {
  // 코드 실행
} finally {
  // 원본 console 복원
  window.console = originalConsole;
}
```

### 2. JSON 직렬화 에러
**문제**: 순환 참조가 있는 객체나 특수 객체 출력 시 `JSON.stringify` 에러 발생

**해결**:
```javascript
try {
  return JSON.stringify(arg, null, 2);
} catch (e) {
  return String(arg);  // 실패 시 문자열 변환으로 폴백
}
```

### 3. 데이터 파싱 안정성
**문제**: localStorage의 손상된 데이터로 인한 애플리케이션 크래시

**해결**:
```javascript
function read(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  } catch {
    return fallback;  // 파싱 실패 시 안전한 기본값 반환
  }
}
```

### 4. 실시간 동기화 충돌
**문제**: 여러 사용자가 동시에 코드를 수정할 때 변경사항 충돌

**해결**:
- Socket.IO를 통한 브로드캐스팅
- 클라이언트 ID로 자신의 변경사항 필터링
- 600ms 디바운싱으로 네트워크 부하 감소

---

## 📊 기술 스택

### Frontend
- **React 19.2.0**: UI 컴포넌트 개발
- **React Router DOM 6.30.1**: 라우팅
- **Vite 6.2.0**: 빌드 도구
- **Socket.IO Client 4.7.5**: 실시간 통신

### Backend
- **Express 4.19.2**: REST API 서버
- **Socket.IO 4.7.5**: 실시간 양방향 통신
- **JWT (jsonwebtoken 9.0.2)**: 사용자 인증
- **bcryptjs 2.4.3**: 비밀번호 해싱
- **Node.js vm 모듈**: 코드 샌드박스 실행

### DevTools
- **Nodemon 3.1.7**: 서버 자동 재시작
- **Concurrently 9.0.1**: 클라이언트/서버 동시 실행

---

## 🔄 향후 개선 계획

### 1. 비동기 코드 지원 (미완성)
**현재 상태**: Promise, async/await 코드가 제대로 실행되지 않음

**개선 계획**:
```javascript
// AsyncFunction Constructor 활용
const AsyncFunction = async function () {}.constructor;
const asyncFn = new AsyncFunction(code);
const result = await asyncFn();
```

또는 Web Worker를 활용한 별도 스레드 실행 고려

### 2. Monaco Editor 통합
**목표**: VS Code 수준의 에디터 기능 제공

**추가 기능**:
- 문법 강조 (Syntax Highlighting)
- 자동 완성 (IntelliSense)
- 라인 넘버
- 코드 포맷팅
- 에러 표시 (Linting)

**예상 구현**:
```javascript
import Editor from '@monaco-editor/react';

<Editor
  height="600px"
  defaultLanguage="javascript"
  value={code}
  onChange={setCode}
  theme="vs-dark"
  options={{
    minimap: { enabled: false },
    fontSize: 14,
    lineNumbers: 'on',
    scrollBeyondLastLine: false
  }}
/>
```

### 3. 추가 개선 사항
- [ ] TypeScript 지원
- [ ] 다중 파일 프로젝트 지원
- [ ] 코드 스니펫 라이브러리
- [ ] 코드 실행 히스토리
- [ ] 성능 프로파일링
- [ ] 단위 테스트 프레임워크 통합

---

## 📚 학습 내용 요약

### 1. React Hooks 활용
- `useState`: 상태 관리 (코드, 출력, 실행 상태)
- `useCallback`: 함수 메모이제이션으로 성능 최적화
- `useEffect`: 부수 효과 처리 (Socket.IO 연결, 데이터 로딩)

### 2. Function Constructor 기반 동적 코드 실행
- 문자열 코드를 실행 가능한 함수로 변환
- 샌드박스 환경에서 사용자 코드 실행
- 보안 및 에러 처리의 중요성 학습

### 3. 로컬 스토리지를 통한 데이터 영속성
- 클라이언트 사이드 데이터 저장
- JSON 직렬화/역직렬화
- 데이터 무결성 처리 (try-catch fallback)

### 4. 실시간 통신 (Socket.IO)
- 양방향 통신 패턴
- Room 기반 이벤트 브로드캐스팅
- 클라이언트 간 데이터 동기화

---

## 📈 프로젝트 진행률

```
전체 진행률: ████████░░ 80%

✅ 완료된 작업
├─ 기본 UI 구현 (100%)
├─ 코드 실행 엔진 (90%)
├─ 콘솔 시스템 (100%)
├─ 로컬 스토리지 (100%)
├─ 서버 API (100%)
└─ 실시간 동기화 (85%)

🚧 진행 중
├─ 비동기 코드 지원 (30%)
└─ Monaco Editor 통합 (0%)

📋 예정
├─ TypeScript 지원
├─ 다중 파일 프로젝트
└─ 고급 디버깅 도구
```

---

## 🔗 참고 자료

- **GitHub Repository**: https://github.com/enderpawar/2025_web_programming
- **커밋 히스토리**: 구체적인 변경 사항은 GitHub 커밋 히스토리 참조
- **프로젝트 구조**: 
  ```
  ├── components/          # React 컴포넌트
  │   ├── Editor.jsx       # 코드 에디터
  │   ├── Console.jsx      # 콘솔 출력
  │   └── RoomCompiler.jsx # 메인 컴파일러
  ├── server/              # Express 서버
  │   ├── index.js         # API 엔드포인트
  │   └── lib.js           # 유틸리티 함수
  ├── storage.js           # 로컬 스토리지 관리
  └── types.js             # 타입 정의
  ```

---

## ✨ 결론

2주차 프로젝트를 통해 **브라우저 기반 JavaScript 온라인 컴파일러의 핵심 기능**을 성공적으로 구현했습니다. 

- **React Hooks**를 활용한 효율적인 상태 관리
- **Function Constructor**와 **Console API 오버라이딩**을 통한 동적 코드 실행
- **로컬 스토리지**를 활용한 데이터 영속성
- **Socket.IO**를 통한 실시간 협업 기능

등을 학습하고 실제로 적용했습니다.

다음 주차에는 **Monaco Editor 통합**과 **비동기 코드 지원**에 집중하여 더욱 완성도 높은 온라인 코드 실행 환경을 만들 예정입니다.

---

**작성일**: 2025년 11월 24일  
**작성자**: [작성자명]  
**프로젝트 저장소**: https://github.com/enderpawar/2025_web_programming
